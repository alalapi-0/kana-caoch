<!--
  跟读训练页面：示例句卡片 + 操作按钮 + 结果反馈。
  录音按钮在录制时显示 Loading，以提示用户当前状态。
-->
<view class="shadowing-page">
  <view class="sentence-card">
    <van-cell
      title="示例句"
      value="第 {{currentIndex + 1}} 条"
      label="{{currentSentence.jp}}"
      border="false"
    />
    <view class="sentence-extra">
      <text>罗马音：{{hintVisible ? currentSentence.romaji : '点击下方按钮查看'}}</text>
      <text>提示：{{hintVisible ? currentSentence.hint : '保持专注，注意语调'}} </text>
    </view>
    <view class="sentence-actions">
      <van-button size="small" type="primary" plain="true" loading="{{loadingTts}}" bindtap="play">播放示例</van-button>
      <van-button size="small" type="default" bindtap="toggleHint">{{hintVisible ? '隐藏提示' : '显示提示'}}</van-button>
    </view>
  </view>

  <view class="record-actions">
    <van-button
      type="danger"
      round="true"
      block="true"
      loading="{{recording}}"
      bindtap="startRecording"
    >开始录音</van-button>
    <van-button
      type="success"
      round="true"
      block="true"
      loading="{{uploading}}"
      bindtap="stopRecording"
    >结束并上传</van-button>
  </view>

  <view class="result-card" wx:if="{{result}}">
    <van-cell title="识别文本" label="{{result.text}}" border="false" />
    <view class="result-meta">
      <van-tag type="warning">WER {{((result.wer || 0) * 100).toFixed(1)}}%</van-tag>
      <van-tag type="primary">编辑距离 {{result.distance || 0}}</van-tag>
    </view>
    <van-progress percentage="{{scorePercent}}" stroke-width="10" pivot-text="得分 {{scorePercent}}%" />
    <star-rating stars="{{result.stars}}" />
    <view class="result-actions">
      <van-button size="small" type="primary" bindtap="toResult">前往结果页</van-button>
    </view>
  </view>

  <van-toast id="van-toast" />
</view>
